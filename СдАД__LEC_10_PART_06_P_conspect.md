# Расчёт критерия хи-квадрат Пирсона в Python

## Импорт библиотек и подготовка данных

Для расчёта критерия хи-квадрат Пирсона необходимо импортировать библиотеки `pandas` и `scipy.stats`. В качестве примера будем использовать датасет с данными о пациентах с сердечно-сосудистыми заболеваниями.

```python
import pandas as pd
from scipy.stats import chi2_contingency
```

## Формулировка гипотезы

Будем рассматривать две категориальные переменные:
* Переменная `sex`, которая выражает пол пациента (1 — мужчина, 0 — женщина).
* Целевая переменная `target`, которая показывает, было ли у пациента диагностировано сердечно-сосудистое заболевание (1 — да, 0 — нет).

Нулевая гипотеза заключается в том, что распределение наблюдений по этим переменным и их категориям независимо.

## Уровень значимости и степени свободы

Выберем уровень значимости $\alpha = 0,01$. Это означает, что мы хотим иметь возможность только одного процента ошибки первого рода.

Для расчёта степеней свободы необходимо построить таблицу сопряжённости. В нашем случае таблица будет выглядеть следующим образом:

| Пол   | Без заболевания | С заболеванием |
|-------|-----------------|----------------|
| Женщины | 24              | 72             |
| Мужчины | 14              | 93             |

Степени свободы рассчитываются по формуле $(количество\ строк - 1) \times (количество\ колонок - 1)$. В нашем случае это будет $(2 - 1) \times (2 - 1) = 1$.

Критическое значение для критерия хи-квадрат при одной степени свободы и уровне значимости $\alpha = 0,01$ равно 6,63.

```mermaid
flowchart LR
    A[Таблица сопряжённости] --> B[Степени свободы = (2-1) * (2-1) = 1]
    B --> C[Критическое значение = 6.63]
```

*Диаграмма иллюстрирует процесс расчёта степеней свободы и критического значения для критерия хи-квадрат.*

## Расчёт теоретических частот

Для расчёта теоретических частот необходимо знать общее количество наблюдений и количество пациентов, у которых не диагностировали сердечно-сосудистое заболевание.

Теоретические частоты для женщин, у которых не диагностировали заболевание, рассчитываются по формуле:

$Теоретическая\ частота = Общее\ количество\ женщин \times Вероятность\ того,\ что\ у\ пациента\ не\ диагностировано\ заболевание$

Аналогично рассчитываются теоретические частоты для остальных категорий.

```mermaid
flowchart LR
    A[Общее количество женщин] --> B[Вероятность отсутствия заболевания]
    B --> C[Теоретическая частота]
```

*Диаграмма показывает процесс расчёта теоретических частот для каждой категории.*

## Расчёт критерия хи-квадрат

Критерий хи-квадрат рассчитывается по формуле:

$\chi^2 = \sum \frac{(Наблюдаемая\ частота - Теоретическая\ частота)^2}{Теоретическая\ частота}$

В Python это можно сделать следующим образом:

```python
chi2, p, dof, expected = chi2_contingency(observed)
```

где `observed` — матрица наблюдаемых частот.

## Проверка гипотезы

Если значение критерия хи-квадрат больше критического значения, то нулевая гипотеза отвергается. В нашем случае значение критерия равно 23,9, что больше критического значения 6,63. Следовательно, зависимость между категориями и полом, скорее всего, есть.

```mermaid
flowchart LR
    A[Значение критерия = 23.9] --> B[Критическое значение = 6.63]
    B --> C{23.9 > 6.63?}
    C -->|Да| D[Нулевая гипотеза отвергается]
```

*Диаграмма демонстрирует процесс проверки гипотезы на основе сравнения значения критерия с критическим значением.*

## Использование функции из библиотеки

Для расчёта критерия хи-квадрат можно использовать функцию `chi2_contingency` из библиотеки `scipy.stats`. В качестве аргумента передаётся матрица наблюдаемых частот. Функция возвращает значение критерия, статистическую значимость, количество степеней свободы и матрицу ожидаемых частот.

![](images/СдАД__LEC_10_PART_06_P/000239s_top_7.jpg)